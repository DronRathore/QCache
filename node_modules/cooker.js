/*
	The Cooker class to validate sessions
*/
var config = require("../config/config.js").config;
var fs = require("fs");
var parser = require("parser").parser;
exports.cooker = {};
exports.cooker.checkSession = function( Key ){
	if ( fs.existsSync( config.sessionDir + config.sessionPrefix + Key + config.sessionSuffix ) ) {
		if ( data = fs.readFileSync( config.sessionDir + config.sessionPrefix + Key + config.sessionSuffix, {encoding: "utf-8"} ) ) {
			var filter = new parser();
			if (config.session == "php"){
				var enteries = filter.explode(data, ";");
				var gtg = false;
				if ( enteries ) {
					for ( i=0; i<enteries.length; i++) {
						if ( enteries[i].indexOf(config.sessionKey) != -1 ) {
							gtg = i;
							break;
						}
					}
					if ( gtg != false || gtg === 0 ) {
						/*
							Another set of check
							need to be assured we are not inside a literal[Quick Fix]
						*/
						if ( enteries[gtg].substr(enteries[gtg].indexOf( config.sessionKey )+config.sessionKey.length, 1) == "|" ) {
						/*
							is logged in
						*/
						return true;
						
						} else {
							return false;
						}
					} else {
						/*
							not logged in
						*/
						return false;
					}
				}
				console.log("[warning] The session file has non-understandable code, are you sure it is php?\nSESSION_CODE: "+key);
			}
		}
	} else {
		return false;
	}
};